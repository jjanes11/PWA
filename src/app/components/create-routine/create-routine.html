<div class="jacaona-create-routine-page">
  <!-- Top Bar -->
  <header class="jacaona-topbar">
    <button class="jacaona-btn-link jacaona-cancel" (click)="cancel()">Cancel</button>
    <h1 class="jacaona-title">Create Routine</h1>
    <button class="jacaona-btn jacaona-btn-primary" (click)="save()">Save</button>
  </header>

  <!-- Main Content -->
  <main class="jacaona-content">
    <div class="jacaona-field">
      <input
        class="jacaona-input-title"
        type="text"
        [(ngModel)]="title"
        placeholder="Routine title"
        aria-label="Routine title"
      />
    </div>

    @if (!currentWorkout()?.exercises || currentWorkout()!.exercises.length === 0) {
      <!-- Empty State -->
      <div class="jacaona-empty-state">
        <div class="jacaona-empty-icon">
          <svg viewBox="0 0 24 24" width="56" height="56" fill="currentColor" aria-hidden="true">
            <path d="M3 10h2v4H3v-4Zm3-3h2v10H6V7Zm12 0h-2v10h2V7Zm3 3h-2v4h2v-4ZM9 11h6v2H9v-2Z"/>
          </svg>
        </div>
        <p class="jacaona-empty-hint">Get started by adding an exercise to your routine.</p>
      </div>
    } @else {
      <!-- Exercises List -->
      <div class="jacaona-exercises-container">
        @for (exercise of currentWorkout()!.exercises; track exercise.id) {
          <div class="jacaona-exercise-card">
            <!-- Exercise Name -->
            <h3 class="jacaona-exercise-title">{{ exercise.name }}</h3>
            
            <!-- Sets Table -->
            <div class="jacaona-sets-table">
              <!-- Table Headers -->
              <div class="jacaona-table-header">
                <div class="jacaona-header-set">SET</div>
                <div class="jacaona-header-weight">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/>
                  </svg>
                  KG
                </div>
                <div class="jacaona-header-reps">REPS</div>
              </div>
              
              <!-- Table Rows -->
              @for (set of exercise.sets; track set.id; let i = $index) {
                <div class="jacaona-table-row">
                  <div class="jacaona-cell-set" (click)="openSetTypeMenu(exercise.id, set.id, $event)">
                    @if (set.type && set.type !== 'normal') {
                      <span [class]="'jacaona-set-type-char ' + getSetTypeClass(set.type)">{{ getSetTypeDisplay(set.type) }}</span>
                    } @else {
                      {{ i + 1 }}
                    }
                  </div>
                  <div class="jacaona-cell-weight">
                    <input 
                      type="number" 
                      [value]="set.weight" 
                      (input)="updateSet(exercise.id, set.id, 'weight', +$any($event.target).value)"
                      class="jacaona-input"
                      min="0"
                      step="0.5"
                    />
                  </div>
                  <div class="jacaona-cell-reps">
                    <input 
                      type="number" 
                      [value]="set.reps" 
                      (input)="updateSet(exercise.id, set.id, 'reps', +$any($event.target).value)"
                      class="jacaona-input"
                      min="0"
                    />
                  </div>
                </div>
              }
            </div>
            
            <!-- Add Set Button -->
            <button class="jacaona-add-set-btn" (click)="addSetToExercise(exercise.id)">
              + Add Set
            </button>
          </div>
        }
      </div>
    }

    <button class="jacaona-btn jacaona-btn-primary jacaona-btn-full" (click)="addExercise()">+ Add exercise</button>
  </main>

  <!-- Set Type Menu Overlay -->
  @if (showSetTypeMenu()) {
    <div class="jacaona-menu-overlay" (click)="closeSetTypeMenu()">
      <div class="jacaona-set-type-menu-content" (click)="$event.stopPropagation()">
        <h3 class="jacaona-menu-title">Select Set Type</h3>
        
        <button class="jacaona-menu-item" (click)="setSetType('warmup')">
          <span class="jacaona-menu-icon jacaona-set-type-icon-warmup jacaona-set-type-char">W</span>
          <span class="jacaona-menu-text">Warm Up Set</span>
        </button>
        
        <button class="jacaona-menu-item" (click)="setSetType('normal')">
          <span class="jacaona-menu-icon jacaona-set-type-char">1</span>
          <span class="jacaona-menu-text">Normal Set</span>
        </button>
        
        <button class="jacaona-menu-item" (click)="setSetType('failure')">
          <span class="jacaona-menu-icon jacaona-set-type-icon-failure jacaona-set-type-char">F</span>
          <span class="jacaona-menu-text">Failure Set</span>
        </button>
        
        <button class="jacaona-menu-item" (click)="setSetType('drop')">
          <span class="jacaona-menu-icon jacaona-set-type-icon-drop jacaona-set-type-char">D</span>
          <span class="jacaona-menu-text">Drop Set</span>
        </button>
        
        <div class="jacaona-menu-separator"></div>
        
        <button class="jacaona-menu-item jacaona-menu-item-danger" (click)="removeSet()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="jacaona-menu-icon jacaona-menu-icon-danger">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
          <span class="jacaona-menu-text jacaona-menu-text-danger">Remove Set</span>
        </button>
      </div>
    </div>
  }
</div>
