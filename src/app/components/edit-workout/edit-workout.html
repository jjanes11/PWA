<div class="jacaona-edit-workout-container">
  @if (currentWorkout(); as w) {
    <!-- Top Bar -->
    <div class="jacaona-top-bar">
      <button class="jacaona-cancel-btn" (click)="cancel()">
        Cancel
      </button>
      <h1 class="jacaona-page-title">Edit Workout</h1>
      <button class="jacaona-save-btn" (click)="saveWorkout()">
        Save
      </button>
    </div>

    <!-- Main Content -->
    <div class="jacaona-main-content">
      <!-- Workout Title Input -->
      <div class="jacaona-input-section">
        <input 
          type="text" 
          class="jacaona-title-input" 
          placeholder="Workout title"
          [(ngModel)]="workoutTitle"
        />
      </div>

      <!-- Workout Summary (Non-editable) -->
      <div class="jacaona-summary-section">
        <div class="jacaona-stats-row">
          <div class="jacaona-stat-item">
            <div class="jacaona-stat-label">Duration</div>
            <div class="jacaona-stat-value jacaona-stat-primary">{{ workoutStats().duration }}</div>
          </div>
          <div class="jacaona-stat-item">
            <div class="jacaona-stat-label">Volume</div>
            <div class="jacaona-stat-value">{{ workoutStats().volume }} kg</div>
          </div>
          <div class="jacaona-stat-item">
            <div class="jacaona-stat-label">Sets</div>
            <div class="jacaona-stat-value">{{ workoutStats().sets }}</div>
          </div>
        </div>
      </div>

      <!-- Separator -->
      <div class="jacaona-separator"></div>

      <!-- When Section -->
      <div class="jacaona-when-section">
        <div class="jacaona-section-title">When</div>
        <div class="jacaona-when-value">{{ workoutDateTime() }}</div>
      </div>

      <!-- Separator -->
      <div class="jacaona-separator"></div>

      <!-- Description Section -->
      <div class="jacaona-description-section">
        <div class="jacaona-section-title">Description</div>
        <textarea 
          class="jacaona-description-input" 
          placeholder="How did your workout go? Leave some notes"
          [(ngModel)]="workoutDescription"
          rows="4"
        ></textarea>
      </div>

      <!-- Separator -->
      <div class="jacaona-separator"></div>

      <!-- Exercises Section -->
      <div class="jacaona-exercises-section">
        <div class="jacaona-section-title">Exercises</div>
        
        @for (exercise of w.exercises; track exercise.id) {
          <div class="jacaona-exercise-item">
            <!-- Exercise Name -->
            <div class="jacaona-exercise-name">{{ exercise.name }}</div>

            <!-- Sets Table -->
            <div class="jacaona-sets-table">
              <div class="jacaona-table-header">
                <div class="jacaona-table-cell">Set</div>
                <div class="jacaona-table-cell">Kg</div>
                <div class="jacaona-table-cell">Reps</div>
                <div class="jacaona-table-cell">âœ“</div>
              </div>
              @for (set of exercise.sets; track set.id; let i = $index) {
                <div class="jacaona-table-row">
                  <div class="jacaona-table-cell jacaona-set-number" (click)="openSetTypeMenu(exercise.id, set.id, $event)">
                    @if (set.type && set.type !== 'normal') {
                      <span [class]="'jacaona-set-type-char ' + getSetTypeClass(set.type)">{{ getSetTypeDisplay(set.type) }}</span>
                    } @else {
                      {{ i + 1 }}
                    }
                  </div>
                  <div class="jacaona-table-cell">
                    <input 
                      type="number" 
                      class="jacaona-set-input"
                      [value]="set.weight"
                      (input)="updateSet(exercise, set, 'weight', +$any($event.target).value)"
                      min="0"
                      step="0.5"
                    />
                  </div>
                  <div class="jacaona-table-cell">
                    <input 
                      type="number" 
                      class="jacaona-set-input"
                      [value]="set.reps"
                      (input)="updateSet(exercise, set, 'reps', +$any($event.target).value)"
                      min="0"
                    />
                  </div>
                  <div class="jacaona-table-cell jacaona-check-cell">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="jacaona-check-icon">
                      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                  </div>
                </div>
              }
            </div>

            <!-- Add Set Button -->
            <button class="jacaona-add-set-btn" (click)="addSet(exercise)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              Add Set
            </button>
          </div>
        }

        <!-- Add Exercise Button -->
        <button class="jacaona-add-exercise-btn" (click)="addExercise()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
          </svg>
          Add Exercise
        </button>
      </div>
    </div>
  } @else {
    <div class="jacaona-loading">
      <p>Loading workout...</p>
    </div>
  }

  <!-- Set Type Menu Overlay -->
  @if (showSetTypeMenu()) {
    <div class="jacaona-menu-overlay" (click)="closeSetTypeMenu()">
      <div class="jacaona-set-type-menu-content" (click)="$event.stopPropagation()">
        <h3 class="jacaona-menu-title">Select Set Type</h3>
        
        <button class="jacaona-menu-item" (click)="setSetType('warmup')">
          <span class="jacaona-menu-icon jacaona-set-type-icon-warmup jacaona-set-type-char">W</span>
          <span class="jacaona-menu-text">Warm Up Set</span>
        </button>
        
        <button class="jacaona-menu-item" (click)="setSetType('normal')">
          <span class="jacaona-menu-icon jacaona-set-type-char">1</span>
          <span class="jacaona-menu-text">Normal Set</span>
        </button>
        
        <button class="jacaona-menu-item" (click)="setSetType('failure')">
          <span class="jacaona-menu-icon jacaona-set-type-icon-failure jacaona-set-type-char">F</span>
          <span class="jacaona-menu-text">Failure Set</span>
        </button>
        
        <button class="jacaona-menu-item" (click)="setSetType('drop')">
          <span class="jacaona-menu-icon jacaona-set-type-icon-drop jacaona-set-type-char">D</span>
          <span class="jacaona-menu-text">Drop Set</span>
        </button>
        
        <div class="jacaona-menu-separator"></div>
        
        <button class="jacaona-menu-item jacaona-menu-item-danger" (click)="removeSet()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="jacaona-menu-icon jacaona-menu-icon-danger">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
          <span class="jacaona-menu-text jacaona-menu-text-danger">Remove Set</span>
        </button>
      </div>
    </div>
  }
</div>
